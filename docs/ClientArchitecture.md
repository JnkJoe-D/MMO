# MMORPG 客户端系统架构总览

本架构表旨在宏观展现当前游戏客户端工程（`GameClient` 及核心库）的结构蓝图，帮助清晰界定各独立模块的边界，并标记目前各子系统的开发进度。

---

## 架构分层与状态

我们将客户端系统划分为四个主要层次。目前，**「核心驱动层」**和**「基础基石层」**的主体设施已建设完毕，可以稳定支撑上层业务。

| 层级 | 系统模块 | 状态 | 职责与说明 |
|:---|:---|:---:|:---|
| **核心驱动层<br/>(Core & Editors)** | 技能编辑器 (`SkillEditor`) | ✅ | 基于时间轴的纯逻辑演算，解耦具体表现。包含各种数据轨道和剪辑的序列化与预览。 |
|                                | 动画系统 (`MAnim`) | ✅ | 核心动画状态机与融合树方案，替代原生 Animator 的高定制度方案。 |
|                                | XLua 脚本环境 | ❌ | **[待开发]** Lua 虚拟机接入，为 UI 逻辑热更、活动逻辑提供执行环境。 |
| **基础基石层<br/>(Framework)**  | 游戏总入口 (`GameRoot`) | ✅ | 全局生命周期的起点，统一驱动各子系统的初始化、Update 和卸载。 |
|                                | 事件中心 (`EventCenter`) | ✅ | 零 GC 的泛型事件总线，负责多模块间的强类型解耦通信。 |
|                                | 对象池 (`GlobalPoolManager`) | ✅ | `GameObject` 与 `Component` 缓存管理，避免频繁 Instantiate 带来的性能开销。 |
|                                | 资源更新 (`ResourceManager`) | ✅ | 接入 YooAsset，支持 Editor/离线/联机的增量热更新与异步并发加载。 |
|                                | 网络通信 (`NetworkManager`) | ✅ | 基于 TCP(可靠通信) 与 UDP(帧同步)，处理 Protobuf 分包/粘包、重连和心跳逻辑。 |
| **通用系统层<br/>(Systems)**     | UI 框架 (`UIManager`) | ✅ | 基于 `UIView/UIModel/UIModule` 的解耦架构，支持层级排序、导航栈管理与 YooAsset 异步加载。 |
|                                | 配置数据 (`ConfigManager`) | ✅ | 基于 Luban 的跨平台配置方案，支持 JSON 全量解析、强类型代码生成及 YooAsset 同步加载。 |
|                                | 场景流转 (`SceneManager`) | ✅ | 包含异步进度处理、防重入保护、场景切换前后的资源与对象池自动清理挂钩。 |
|                                | 音频管理 (`AudioManager`) | ❌ | **[待开发]** 封装 BGM 切换过渡、SFX 混音组控制与内存管理。 |
|                                | 用户输入系统 (`InputSystem`) | ❌ | **[待开发]** 统一捕获移动端摇杆、按键与 PC 键鼠滑动，分发给角色状态机。 |
| **业务逻辑层<br/>(Logic)**       | 登录/角色选择 (`Login/Role`) | ❌ | **[待开发]** 帐号注册登录、Token 获取、角色创建与列表拉取。 |
|                                | 战斗系统 (`BattleSystem`) | ❌ | **[待开发]** 结合网络同步与技能核心，管理单位生成、阵营判定、伤害计算。 |
|                                | Buff 模块 (`BuffSystem`) | ❌ | **[待开发]** 战斗体系扩展：状态附加、属性修饰器、周期性 DOT 与互斥规则。 |
|                                | 行为树/AI (`BehaviorTree`) | ❌ | **[待开发]** 怪物巡逻、索敌、攻击逻辑决策。 |
|                                | 同步组件 (`SyncEntity`) | ❌ | **[待开发]** 大世界平滑插值(状态同步) 与 副本逻辑帧预测回滚(帧同步)。 |

---

## 路线指南

### 🌟 里程碑 1：核心骨架建立 (当前阶段)
目前项目已拥有极强的代码底座，能够稳定执行：
- 基于时间轴的**技能全流程演绎**及**动画融合** (`SkillEditor` / `MAnim`)。
- 全套**内存管理与资产热分发** (`GlobalPool` / `YooAsset`)。
- 坚如磐石的**双通道网络底座** (`TCP` / `UDP` / 心跳重连)。
- 完整的**核心框架链路** (Config 管理 / UI 管道 / 场景自动伸缩流)。

### 📌 里程碑 2：业务驱动中台 (下一阶段建议)
为了让游戏“动起来”，我们需要：
1. **XLua 虚拟机**：接入并打通数据流转，用 Lua 编写 UI 胶水逻辑快速迭代界面。
2. **正式业务逻辑**：实现 `Logo -> Loading -> 登录界面 -> 大厅场景` 的具体业务面板。
3. **InputSystem**：能用手指/键盘驱动角色跑出第一步。

### ⚔️ 里程碑 3：战斗系统与联机闭环 (最终攻坚)
1. 把 `SkillEditor` 和 `BuffSystem` 组合到 `BattleSystem`，打两套连招木桩。
2. 接入 `BehaviorTree`，让木桩怪物活过来。
3. 接通 `NetworkManager` 与 `SyncEntity`，把单机打桩变成百人同屏或 3v3 帧同步。
