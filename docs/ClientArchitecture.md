# MMORPG 客户端系统架构总览

本架构表旨在宏观展现当前游戏客户端工程（`GameClient` 及核心库）的结构蓝图，帮助清晰界定各独立模块的边界，并标记目前各子系统的开发进度。

---

## 架构分层与状态

我们将客户端系统划分为四个主要层次。目前，**「核心驱动层」**和**「基础基石层」**的主体设施已建设完毕，可以稳定支撑上层业务。

| 层级 | 系统模块 | 状态 | 职责与说明 |
|:---|:---|:---:|:---|
| **核心驱动层<br/>(Core & Editors)** | 技能编辑器 (`SkillEditor`) | ✅ | 基于时间轴的纯逻辑演算，解耦具体表现。包含各种数据轨道和剪辑的序列化与预览。 |
|                                | 动画系统 (`MAnim`) | ✅ | 核心动画状态机与融合树方案，替代原生 Animator 的高定制度方案。 |
|                                | XLua 脚本环境 | ❌ | **[待开发]** Lua 虚拟机接入，为 UI 逻辑热更、活动逻辑提供执行环境。 |
| **基础基石层<br/>(Framework)**  | 游戏总入口 (`GameRoot`) | ✅ | 全局生命周期的起点，统一驱动各子系统的初始化、Update 和卸载。 |
|                                | 事件中心 (`EventCenter`) | ✅ | 零 GC 的泛型事件总线，负责多模块间的强类型解耦通信。 |
|                                | 对象池 (`GlobalPoolManager`) | ✅ | `GameObject` 与 `Component` 缓存管理，避免频繁 Instantiate 带来的性能开销。 |
|                                | 资源更新 (`ResourceManager`) | ✅ | 接入 YooAsset，支持 Editor/离线/联机的增量热更新与异步并发加载。 |
|                                | 网络通信 (`NetworkManager`) | ✅ | 基于 TCP(可靠通信) 与 UDP(帧同步)，处理 Protobuf 分包/粘包、重连和心跳逻辑。 |
| **通用系统层<br/>(Systems)**     | UI 框架 (`UIManager`) | ✅ | 基于 `UIView/UIModel/UIModule` 的解耦架构，支持层级排序、导航栈管理与 YooAsset 异步加载。 |
|                                | 配置数据 (`ConfigManager`) | ✅ | 基于 Luban 的跨平台配置方案，支持 JSON 全量解析、强类型代码生成及 YooAsset 同步加载。 |
|                                | 场景流转 (`SceneManager`) | ✅ | 包含异步进度处理、防重入保护、场景切换前后的资源与对象池自动清理挂钩。 |
|                                | 音频管理 (`AudioManager`) | ❌ | **[待开发]** 封装 BGM 切换过渡、SFX 混音组控制与内存管理。 |
|                                | 用户输入系统 (`InputSystem`) | ❌ | **[待开发]** 统一捕获移动端摇杆、按键与 PC 键鼠滑动，分发给角色状态机。 |
| **业务逻辑层<br/>(Logic)**       | 账户与流转 (`Login/Loading`) | ✅ | 帐号注册登录、TCP Token 获取、多层级 UI 隔离、场景与依赖资源混合过场加载流。 |
|                                | 角色构建 (`RoleCreate`)     | ❌ | **[待开发]** 角色捏脸、职业选择、角色列表拉取与数据下发。 |
|                                | 战斗系统 (`BattleSystem`)   | ❌ | **[待开发]** 结合网络同步与技能核心，管理单位生成、阵营判定、伤害计算。 |
|                                | Buff 模块 (`BuffSystem`)   | ❌ | **[待开发]** 战斗体系扩展：状态附加、属性修饰器、周期性 DOT 与互斥规则。 |
|                                | 行为树/AI (`BehaviorTree`)  | ❌ | **[待开发]** 怪物巡逻、索敌、攻击逻辑决策。 |
|                                | 同步组件 (`SyncEntity`)     | ❌ | **[待开发]** 大世界平滑插值(状态同步) 与 副本逻辑帧预测回滚(帧同步)。 |

---

## 路线指南

### 🌟 里程碑 1：核心基座与全链路贯通 (✅ 当前已达成)
经历了前期的底层建设与后期的上层业务梳理，目前项目已从“组件拼凑”一跃成为了“可全流程运转”的正规军：
- **资源分发全闭环**：基于 `YooAsset` 的完整增量热更新、版本对比与失败重试机制已稳定运作。
- **界面与多媒体架构**：实现了基于 `UIManager` 的弹窗/覆盖/黑底防并发遮罩 (`NetWaitModule`) 以及平滑背景视频层分离。
- **真实网络发包对接**：基于 TCP Protobuf 生成管道（`gen.bat` 自动化），已成功下发并接收业务级 `Login/Register` 封包流。
- **场景混合转场流水线**：摒弃原生裸读方案，实现了 `清理旧资源 -> 读骨架场景 -> 读必选依赖(ReqAssets) -> 初始化` 的四段式带进度条工业级 Loading。
- **表现力下层基础**：基于时间轴的技能演算 (`SkillEditor`) 及动画融合 (`MAnim`) 等底层战术组件亦储备就绪。

### 📌 里程碑 2：业务驱动中台与角色场景建设 (🚀 下一阶段主力战区)
随着“大门”已被彻底推开，现在我们要让游戏内部的框架真正立起来：
1. **角色管线建设**：在正式步入主城前，补齐拉取角色列表、创建角色的数据包传输与镜头组切换面板。
2. **XLua / 脚本层 (视需求评估)**：如果项目需要频繁修改 UI 和运营活动逻辑，需开始着手 Lua 虚拟机和 C# 的宿主绑定。
3. **输入与相机系统 (Input & Camera)**：接入移动端摇杆 / PC 键鼠，实现第三人称或俯视角越肩相机，让主角在刚加载出的第一张地图上跑起来。
4. **音频管理 (AudioManager)**：封装 BGM 过渡、SFX 混音控制，给寂静的世界注入声音。

### ⚔️ 里程碑 3：战斗系统与联机闭环 (最终攻坚)
1. 把 `SkillEditor` 和 `BuffSystem` 组合到 `BattleSystem`，打两套连招木桩。
2. 接入 `BehaviorTree`，让木桩怪物活过来。
3. 接通 `NetworkManager` 与 `SyncEntity`，把单机打桩变成百人同屏或 3v3 帧同步。
