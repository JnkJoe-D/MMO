# 接手分析报告（Unity 客户端）

本报告基于当前工程快照（2026-02-26）完成，按要求仅读取了 `docs/ClientArchitecture.md`，并忽略其他 `docs` 下 Markdown。

## 1. 项目总览

- Unity 版本：`2022.3.44f1c1`（`ProjectSettings/ProjectVersion.txt`）。
- 顶层核心目录：`Assets`、`Packages`、`Configs`、`Protobuf`、`.agent`、`.agents`。
- 资产结构重点：`Assets/GameClient`（主客户端代码）、`Assets/Editor`（通用编辑器工具）、`Assets/Plugins`（原生/托管插件）、`Assets/XLua`（Lua 相关）。

## 2. 第三方插件/库/包

- UPM 关键依赖（`Packages/manifest.json`）：
  - `com.tuyoogame.yooasset` `2.3.17`
  - `com.code-philosophy.luban`（Git）
  - `com.greenbamboogames.playablegraphmonitor`（Git）
  - `com.unity.inputsystem`、`URP`、`TMP`、`timeline` 等
- 锁定信息（`Packages/packages-lock.json`）显示 Luban/PlayableGraphMonitor 已固定到具体 commit。
- 插件层：
  - Protobuf DLL 在 `Assets/Plugins/Protobuf`
  - XLua 各平台二进制在 `Assets/Plugins` 与 `Assets/XLua`
  - lilToon 编辑器脚本在 `Assets/Resources/Shaders/lilToon`

## 3. GameClient 代码架构（重点）

- 启动与总线：
  - 全局入口 `Assets/GameClient/Framework/GameRoot.cs`
  - 事件中心 `Assets/GameClient/Framework/Events/EventCenter.cs`
- 基础系统：
  - 资源热更 `Assets/GameClient/Resource/ResourceManager.cs`、`Assets/GameClient/Resource/ResourceUpdater.cs`
  - 网络总管 `Assets/GameClient/Network/Core/NetworkManager.cs`、协议编解码 `Assets/GameClient/Network/Core/PacketCodec.cs`
  - 场景流转 `Assets/GameClient/Scene/SceneManager.cs`
  - 对象池 `Assets/GameClient/Pool/GlobalPoolManager.cs`
  - 配置加载 `Assets/GameClient/Config/ConfigManager.cs`（Luban）
- UI 框架：
  - 核心 `Assets/GameClient/UI/Core/UIManager.cs`、`Assets/GameClient/UI/Core/UIModule.cs`
  - 当前业务链已打通：热更面板 -> 网络连接 -> 登录/注册 -> 加载界面
- 技能系统（占比最大）：
  - `Assets/GameClient/SkillEditor` 下 Runtime + Editor 完整分层，Process/Track/Clip 扩展性较强。

## 4. Editor 脚本架构

- 通用编辑器工具（非 SkillEditor）：
  - `Assets/Editor/Tools/UI/UiAutoBindWindow.cs`
  - `Assets/Editor/Tools/SkeletonPoseCopier.cs`
- SkillEditor 编辑器侧：
  - 主窗口 `Assets/GameClient/SkillEditor/Editor/SkillEditorWindow.cs`
  - 预览驱动 `Assets/GameClient/SkillEditor/Editor/Playback/SkillEditorWindow.Preview.cs`
  - 轨道注册 `Assets/GameClient/SkillEditor/Editor/Core/TrackRegistry.cs`

## 5. .agent / workflows 规则

- 全局规则文件：
  - `.agent/rules/coderules.md`
  - 关键约束：中文注释/文档、命名与代码风格约定、改动规模分级流程、禁止改动第三方目录等。
- 工作流文件（`.agents/workflows`）：
  - `analyze-skill-editor.md`
  - `create_ui_module.md`
  - `skilleditor-development-guide.md`
- 观察：workflow 文档里部分路径写的是 `Assets/SkillEditor`，而当前实际路径是 `Assets/GameClient/SkillEditor`，后续执行需按实际目录修正。

## 6. 与进度文档一致性（当前可接手状态）

- 与 `docs/ClientArchitecture.md` 基本一致：
  - 已完成：GameRoot/资源热更/UI框架/网络主链路/SkillEditor 与 MAnim 基座。
  - 未完成：Input、AudioManager、RoleCreate、Battle/Buff/AI/SyncEntity 等仍处于待开发或骨架期。
- 代码层面可验证“部分待开发”：
  - `Assets/GameClient/Input/InputManager.cs` 仍是占位实现。
  - `Assets/GameClient/SkillEditor/Runtime/Playback/Processes/CameraProcess.cs`、`MovementProcess.cs` 为 TODO 骨架。

## 7. 接手风险与优先关注点

- `Assets/GameClient/UI/Modules/Register/RegisterModule.cs` 中 `RefreshView` 把邮箱写入了 `tag`，不是 `text`，疑似 UI 逻辑 bug。
- `Assets/GameClient/Adapters/SkillServiceFactory.cs` 对 `ISkillAudioHandler` 每次可能 `AddComponent`，长期可能重复挂载。
- `Assets/GameClient/Framework/GameRoot.cs` 初始化步骤编号/注释与实际顺序有不一致，建议统一文档化。
- SkillEditor 序列化实现是 `Assets/GameClient/SkillEditor/Runtime/Serialization/SerializationUtility.cs`（`JsonUtility` 路线），与部分 workflow 描述的 `Newtonsoft` 不一致，后续扩展多态时需谨慎验证。

## 8. 结论

当前项目已具备“可进入业务开发”的基础能力：启动、热更、网络、UI、配置、场景与技能框架均已连通；下一阶段建议优先处理输入/音频落地与业务系统主线补齐，并先清理已识别的关键风险点。
